<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 古箏考級賽事情報 | 新莊箏心古箏音樂教室</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        body { font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif; background-color: #fafaf9; }
        
        /* 強制設定圖表容器高度 */
        .chart-container { 
            position: relative; 
            width: 100%; 
            height: 350px; 
            min-height: 350px;
            margin: 0 auto; 
        }
        
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        /* 自訂滾動條 */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #d6d3d1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a8a29e; }
    </style>
</head>
<body class="text-stone-800 flex flex-col min-h-screen">

    <nav class="sticky top-0 z-50 shadow-lg text-white" style="background-color: #4A3520;">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center h-[70px]">
                <a href="../index.html" class="text-xl font-bold tracking-wider hover:text-[#D2B48C] transition-colors duration-300 flex items-center gap-2">
                    <i class="fas fa-music"></i> 新莊箏心
                </a>
                <div class="hidden md:flex items-center space-x-8">
                    <a href="../index.html#about" class="font-bold hover:text-[#D2B48C] transition-colors duration-300">關於我們</a>
                    <a href="../index.html#courses" class="font-bold hover:text-[#D2B48C] transition-colors duration-300">課程資訊</a>
                    <a href="../index.html#teachers" class="font-bold hover:text-[#D2B48C] transition-colors duration-300">師資介紹</a>
                    <div class="relative group">
                        <button class="font-bold hover:text-[#D2B48C] transition-colors duration-300 flex items-center gap-1 py-4">
                            學習指南 <i class="fas fa-chevron-down text-xs"></i>
                        </button>
                        <div class="absolute left-1/2 transform -translate-x-1/2 top-full w-48 bg-[#4A3520] border border-[#D2B48C] rounded shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 flex flex-col py-2">
                            <a href="https://scm-event.tw/" target="_blank" class="px-4 py-2 hover:bg-[#D2B48C] hover:text-[#4A3520] transition-colors text-sm">國樂學會報名</a>
                            <a href="#" class="px-4 py-2 hover:bg-[#D2B48C] hover:text-[#4A3520] transition-colors text-sm">黃鐘獎考級</a>
                        </div>
                    </div>
                    <a href="../index.html#gallery" class="font-bold hover:text-[#D2B48C] transition-colors duration-300">學生成果</a>
                    <a href="../index.html#contact" class="font-bold hover:text-[#D2B48C] transition-colors duration-300">聯絡我們</a>
                    <div class="h-6 w-px bg-white/30 mx-2"></div>
                    <span class="text-[#D2B48C] font-bold text-sm bg-black/20 px-3 py-1 rounded-full">
                        <i class="fas fa-chart-line mr-1"></i> 備考情報
                    </span>
                </div>
                <button id="mobile-menu-btn" class="md:hidden text-2xl focus:outline-none hover:text-[#D2B48C] transition-colors">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-[#4A3520] border-t border-[#D2B48C]/30 absolute w-full left-0 shadow-xl">
            <div class="flex flex-col p-4 space-y-4 text-center">
                <a href="../index.html#about" class="block py-2 hover:text-[#D2B48C] font-bold border-b border-white/10">關於我們</a>
                <a href="../index.html#courses" class="block py-2 hover:text-[#D2B48C] font-bold border-b border-white/10">課程資訊</a>
                <a href="../index.html#teachers" class="block py-2 hover:text-[#D2B48C] font-bold border-b border-white/10">師資介紹</a>
                <a href="https://scm-event.tw/" target="_blank" class="block py-2 hover:text-[#D2B48C] font-bold border-b border-white/10">學習指南 (考級)</a>
                <a href="../index.html#gallery" class="block py-2 hover:text-[#D2B48C] font-bold border-b border-white/10">學生成果</a>
                <a href="../index.html#contact" class="block py-2 hover:text-[#D2B48C] font-bold">聯絡我們</a>
            </div>
        </div>
    </nav>

    <main class="flex-grow container mx-auto px-4 py-8 space-y-12">
        <section class="max-w-5xl mx-auto space-y-4">
            <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-amber-500">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-2xl font-bold text-amber-900 mb-2">年度規劃指南 (2026/02/5 更新)</h2>
                        <p class="text-stone-600 leading-relaxed">
                            歡迎來到<strong>新莊箏心古箏音樂教室</strong>的學員情報站。
                            <br>本頁面整合了 <span class="font-bold text-amber-700">國樂學會</span> 與 <span class="font-bold text-amber-700">全國音樂考級(黃鐘獎)</span> 等重要資訊，助您提早規劃練習進度。
                        </p>
                    </div>
                    <i class="fas fa-music text-amber-100 text-6xl -mt-2 -mr-2"></i>
                </div>
            </div>
            <div class="bg-red-50 border border-red-200 p-4 rounded-xl flex items-start space-x-4 animate-pulse">
                <div class="bg-red-100 p-2 rounded-full text-red-600 mt-1 flex-shrink-0">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div>
                    <h3 class="font-bold text-red-800">賽事異動提醒：2026 臺北市民族器樂大賽</h3>
                    <p class="text-red-700 text-sm mt-1">
                        經確認，2026年該賽事指定樂器為 <strong>「琵琶」</strong>。
                        古箏演奏者今年 <span class="underline font-bold">無此項目</span>，請勿白跑一趟！
                    </p>
                </div>
            </div>
        </section>

        <section class="bg-white p-6 rounded-2xl shadow-md border border-stone-100">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-stone-800 flex items-center gap-2">
                    <div class="w-1 h-6 bg-amber-600 rounded"></div>
                    考級與比賽時程圖
                </h2>
                <div class="flex gap-4 text-sm mt-2 md:mt-0">
                    <div class="flex items-center gap-1"><div class="w-3 h-3 bg-amber-500 rounded"></div> 報名期間</div>
                    <div class="flex items-center gap-1"><div class="w-3 h-3 bg-red-600 rounded"></div> 考試/比賽日</div>
                </div>
            </div>
            <div class="w-full flex justify-center">
                <div class="chart-container">
                    <canvas id="scheduleChart"></canvas>
                </div>
            </div>
        </section>

        <section>
            <div class="flex flex-col md:flex-row justify-between items-end mb-6 gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-stone-800">近期賽事與檢定</h2>
                    <p class="text-stone-500 text-sm mt-1">系統會自動計算剩餘天數，紅色代表即將截止</p>
                </div>
                <div class="flex flex-wrap gap-2 bg-white p-2 rounded-lg shadow-sm border border-stone-200">
                    <button class="filter-btn active bg-amber-600 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors" data-filter="all">全部</button>
                    <button class="filter-btn hover:bg-stone-100 text-stone-600 px-4 py-2 rounded-md text-sm font-medium transition-colors" data-filter="exam">考級</button>
                    <button class="filter-btn hover:bg-stone-100 text-stone-600 px-4 py-2 rounded-md text-sm font-medium transition-colors" data-filter="competition">比賽</button>
                    <button class="filter-btn hover:bg-red-50 text-red-600 border border-red-100 px-4 py-2 rounded-md text-sm font-medium transition-colors" data-filter="urgent">
                        <i class="fas fa-fire mr-1"></i> 急件
                    </button>
                </div>
            </div>
            <div id="events-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </section>
        
        <section class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-gradient-to-br from-indigo-50 to-white p-6 rounded-xl border border-indigo-100 shadow-sm relative overflow-hidden group">
                <div class="absolute top-0 right-0 w-24 h-24 bg-indigo-100 rounded-full -mr-12 -mt-12 opacity-50 group-hover:scale-110 transition-transform"></div>
                <h3 class="font-bold text-indigo-900 mb-3 flex items-center text-lg">
                    <i class="fas fa-star mr-2 text-indigo-500"></i> 2026 文化盃 (Culture Cup)
                </h3>
                <ul class="space-y-2 text-sm text-indigo-800 mb-4">
                    <li><i class="far fa-calendar-alt w-5 text-center mr-1 opacity-60"></i> <strong>舉辦時間：</strong> 暑假期間 (7/7 ~ 8/6 分區舉辦)</li>
                </ul>
                <a href="https://www.taiwanmusic.org/" target="_blank" class="text-indigo-600 text-sm font-bold hover:text-indigo-800 flex items-center gap-1">
                    前往官網 <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            <div class="bg-gradient-to-br from-emerald-50 to-white p-6 rounded-xl border border-emerald-100 shadow-sm relative overflow-hidden group">
                <div class="absolute top-0 right-0 w-24 h-24 bg-emerald-100 rounded-full -mr-12 -mt-12 opacity-50 group-hover:scale-110 transition-transform"></div>
                <h3 class="font-bold text-emerald-900 mb-3 flex items-center text-lg">
                    <i class="fas fa-graduation-cap mr-2 text-emerald-500"></i> 114學年度全國學生音樂比賽
                </h3>
                <ul class="space-y-2 text-sm text-emerald-800 mb-4">
                    <li><i class="far fa-clock w-5 text-center mr-1 opacity-60"></i> <strong>決賽時間：</strong> 2026年 3月</li>
                </ul>
                <a href="https://web.arte.gov.tw/music/" target="_blank" class="text-emerald-600 text-sm font-bold hover:text-emerald-800 flex items-center gap-1">
                    查看賽程 <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </section>
    </main>

    <footer class="bg-stone-900 text-stone-300 py-12 mt-12 border-t border-amber-900/30">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
                <div class="md:col-span-1 space-y-4">
                    <h2 class="text-xl font-bold text-amber-500 flex items-center gap-2">
                        <i class="fas fa-certificate"></i> 新莊箏心古箏音樂教室
                    </h2>
                    <p class="text-stone-400 text-sm leading-relaxed">
                        備考路上，您不孤單！想要在考級與比賽中脫穎而出嗎？
                        我們擁有 <strong class="text-stone-200">15年教學經驗</strong> 的專業師資團隊，由<strong class="text-stone-200">廖美華老師團隊</strong>親自領軍。
                        提供一對一教學、檢定模擬考與比賽特訓，為您量身打造學習計畫，讓學習變成一種快樂與成就。
                    </p>
                    <a href="../index.html#register" class="inline-block bg-amber-700 hover:bg-amber-600 text-white px-6 py-2 rounded-full text-sm font-bold transition-all shadow-lg hover:shadow-amber-900/50 mt-2">
                        <i class="fas fa-hand-point-right mr-1"></i> 預約體驗課程
                    </a>
                </div>
                <div class="md:col-span-1 space-y-4">
                    <h3 class="text-lg font-bold text-white mb-2 border-b border-stone-700 pb-2">聯絡我們</h3>
                    <ul class="space-y-4 text-sm">
                        <li class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-stone-800 flex items-center justify-center text-green-500 flex-shrink-0">
                                <i class="fab fa-line text-lg"></i>
                            </div>
                            <div>
                                <span class="text-stone-500 text-xs block">官方 Line</span>
                                <a href="https://line.me/ti/p/~@swn8120u" target="_blank" class="text-stone-300 hover:text-white font-mono text-lg transition-colors">@swn8120u</a>
                            </div>
                        </li>
                        <li class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-stone-800 flex items-center justify-center text-blue-500 flex-shrink-0">
                                <i class="fab fa-facebook-f text-lg"></i>
                            </div>
                            <div>
                                <span class="text-stone-500 text-xs block">Facebook 粉絲專頁</span>
                                <a href="https://www.facebook.com/GuzhengTrain" target="_blank" class="text-stone-300 hover:text-white text-base transition-colors">GuzhengTrain</a>
                            </div>
                        </li>
                        <li class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-stone-800 flex items-center justify-center text-red-500 flex-shrink-0">
                                <i class="fas fa-map-marker-alt"></i>
                            </div>
                            <div>
                                <span class="text-stone-500 text-xs block">教室位置</span>
                                <span class="text-stone-300">新北市新莊區 (近新莊體育場)</span>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="md:col-span-1 space-y-4">
                    <h3 class="text-lg font-bold text-white mb-2 border-b border-stone-700 pb-2">常用連結</h3>
                    <ul class="space-y-3 text-sm">
                        <li><a href="../index.html" class="flex items-center gap-2 text-stone-400 hover:text-amber-400 transition-colors"><i class="fas fa-home w-4 text-center"></i> 回到官方網站首頁</a></li>
                        <li><a href="https://scm-event.tw/" target="_blank" class="flex items-center gap-2 text-stone-400 hover:text-white transition-colors"><i class="fas fa-external-link-alt w-4 text-center"></i> 國樂學會報名系統</a></li>
                        <li><a href="https://ambitious-watermelon-ddjt20.mystrikingly.com/" target="_blank" class="flex items-center gap-2 text-stone-400 hover:text-white transition-colors"><i class="fas fa-file-alt w-4 text-center"></i> 全國音樂考級 (黃鐘)</a></li>
                    </ul>
                    <div class="pt-4 mt-6 border-t border-stone-800 text-xs text-stone-600">
                        <p class="mb-1">© 2026 新莊箏心古箏音樂教室</p>
                        <p>本頁面資訊更新日期：2026/01/15</p>
                    </div>
                </div>
            </div>
        </div>
    </footer>

 <script>
        // --- 1. 全域變數設定 ---
        const YEAR = 2026;
        const today = new Date(); 
        let events = []; // 改用 let，因為資料會重新被寫入
        let scheduleChart = null; // 儲存圖表實例，以便更新時銷毀舊的

        // --- 2. 工具函式 ---
        function formatDate(date) { 
            return `${date.getMonth() + 1}/${date.getDate()}`; 
        }
        
        function calculateDaysRemaining(target) { 
            return Math.ceil((target - today) / (1000 * 60 * 60 * 24)); 
        }
        
        function getStatus(event) {
            let daysLeft = 999, status = 'upcoming';
			if (!event.regStart && !event.regEnd) {
				return { status: 'tba', daysLeft: 0 };
				}
            // 確保日期物件存在才進行比較
            if (event.regStart && event.regEnd) {
                if (today < event.regStart) { 
                    status = 'upcoming'; 
                    daysLeft = calculateDaysRemaining(event.regStart); 
                } else if (today <= event.regEnd) { 
                    status = 'open'; 
                    daysLeft = calculateDaysRemaining(event.regEnd); 
                    if(daysLeft <= 7) status = 'urgent'; 
                } else { 
                    status = 'closed'; 
                }
            } else if (event.regEnd) {
                daysLeft = calculateDaysRemaining(event.regEnd);
                if (daysLeft < 0) status = 'closed'; 
                else if (daysLeft <= 10) status = 'urgent'; 
                else status = 'open';
            }
            return { status, daysLeft };
        }

        // --- 3. 核心功能：載入資料 ---
        async function loadData() {
            try {
                const response = await fetch('./events.json');
                if (!response.ok) throw new Error('Network response was not ok');
                
                const rawData = await response.json();

                // ★ 關鍵修正：將 JSON 字串轉換為 Date 物件
                events = rawData.map(event => ({
                    ...event,
                    regStart: event.regStart ? new Date(event.regStart) : null,
                    regEnd: event.regEnd ? new Date(event.regEnd) : null,
                    examDates: event.examDates ? event.examDates.map(d => new Date(d)) : []
                }));

                // 資料準備好後，才執行渲染
                renderCards();
                initChart();

            } catch (error) {
                console.error("資料載入失敗:", error);
                const container = document.getElementById('events-grid');
                if(container) container.innerHTML = `<div class="col-span-full text-center text-red-500 py-10">資料讀取發生錯誤，請稍後再試。<br><span class="text-xs text-stone-400">${error.message}</span></div>`;
            }
        }

        // --- 4. 渲染卡片 ---
        function renderCards(filter = 'all') {
            const container = document.getElementById('events-grid');
            if(!container) return;
            container.innerHTML = '';
            
            const sortedEvents = [...events].sort((a, b) => {
                const statusOrder = { 'urgent': 1, 'open': 2, 'upcoming': 3, 'closed': 4 };
                const statA = getStatus(a).status, statB = getStatus(b).status;
                if (statusOrder[statA] !== statusOrder[statB]) return statusOrder[statA] - statusOrder[statB];
                // 安全處理日期相減 (處理 null 的情況)
                const dateA = a.regEnd || a.regStart || new Date(9999,0,1);
                const dateB = b.regEnd || b.regStart || new Date(9999,0,1);
                return dateA - dateB;
            });

            const filtered = sortedEvents.filter(e => {
                const s = getStatus(e).status;
                if (filter === 'all') return s !== 'closed';
                if (filter === 'urgent') return e.urgent || s === 'urgent';
                return e.type === filter;
            });

            if (filtered.length === 0) { 
                container.innerHTML = `<div class="col-span-full text-center text-stone-400 py-12 bg-stone-50 rounded-xl border border-dashed border-stone-200">目前沒有符合此條件的項目</div>`; 
                return; 
            }

            filtered.forEach(event => {
                const { status, daysLeft } = getStatus(event);
                let badgeClass = '', badgeText = '', cardBorder = 'border-stone-200 border-l-4 border-l-stone-300';
                
                if (status === 'closed') { 
                    badgeClass = 'bg-stone-200 text-stone-500'; badgeText = '已截止'; cardBorder = 'border-stone-200 border-l-4 border-l-stone-400 opacity-75 grayscale'; 
                } else if (status === 'tba') {
					// 【新增】針對待定活動的灰色標籤
					badgeClass = 'bg-stone-100 text-stone-500'; 
					badgeText = '日期未定'; 
					cardBorder = 'border-stone-200 border-l-4 border-l-stone-300';
				}
				else if (status === 'upcoming') { 
                    badgeClass = 'bg-blue-100 text-blue-700'; badgeText = `還有 ${daysLeft} 天開放`; cardBorder = 'border-stone-200 border-l-4 border-l-blue-400'; 
                } else if (status === 'urgent') { 
                    badgeClass = 'bg-red-100 text-red-700 font-bold animate-pulse'; badgeText = `剩 ${daysLeft} 天截止 !`; cardBorder = 'border-red-200 border-l-4 border-l-red-500 shadow-md'; 
                } else { 
                    badgeClass = 'bg-green-100 text-green-700 font-bold'; badgeText = `報名中 (剩${daysLeft}天)`; cardBorder = 'border-stone-200 border-l-4 border-l-green-500'; 
                }

				let dateDisplay = '<span class="text-stone-400">詳見簡章</span>';
				if (event.regStart && event.regEnd) {
					dateDisplay = `<span class="font-mono">${formatDate(event.regStart)} ~ ${formatDate(event.regEnd)}</span>`;
				} else if (event.regEnd) {
					dateDisplay = `截止日: <span class="font-mono font-bold ${status==='urgent'?'text-red-600':''}">${formatDate(event.regEnd)}</span>`;
				}
                const icon = event.type === 'exam' ? 'fa-clipboard-check' : 'fa-trophy';
                const typeLabel = event.type === 'exam' ? '考級' : '比賽';
                const typeColor = event.type === 'exam' ? 'text-amber-600' : 'text-indigo-600';

                container.innerHTML += `
                    <div class="bg-white rounded-xl p-5 border ${cardBorder} card-hover flex flex-col justify-between h-full relative overflow-hidden">
                        <div>
                            <div class="flex justify-between items-start mb-3">
                                <span class="text-xs font-bold uppercase tracking-wider ${typeColor} flex items-center gap-1"><i class="fas ${icon}"></i> ${typeLabel}</span>
                                <span class="px-2 py-1 rounded-full text-xs ${badgeClass}">${badgeText}</span>
                            </div>
                            <h3 class="text-lg font-bold text-stone-800 mb-1 leading-tight">${event.title}</h3>
                            ${event.note ? `<p class="text-xs text-amber-600 mb-3 font-medium"><i class="fas fa-info-circle"></i> ${event.note}</p>` : '<div class="mb-3"></div>'}
                            <div class="space-y-2 text-sm text-stone-600 mb-4 bg-stone-50 p-3 rounded-lg">
                                <p class="flex items-center"><i class="fas fa-map-marker-alt w-5 text-center mr-2 text-stone-400"></i> ${event.location}</p>
                                <p class="flex items-center"><i class="far fa-clock w-5 text-center mr-2 text-stone-400"></i> ${dateDisplay}</p>
                                <p class="flex items-center">
							<i class="fas fa-calendar-check w-5 text-center mr-2 text-stone-400"></i> 
							考試: ${event.examDates.length > 0 ? event.examDates.map(d => formatDate(d)).join(', ') : '<span class="text-stone-400 text-xs">以官方公告為準</span>'}
								</p>
                            </div>
                        </div>
                        <div class="flex gap-2">
                             <a href="${event.link}" target="_blank" class="flex-1 text-center bg-white hover:bg-amber-50 text-stone-600 hover:text-amber-700 font-medium py-2 rounded-lg transition-colors border border-stone-200 text-sm">簡章/報名</a>
                             ${event.officialSite ? `<a href="${event.officialSite}" target="_blank" class="px-3 py-2 text-stone-400 hover:text-stone-600 bg-stone-50 rounded-lg border border-stone-100" title="官方網站"><i class="fas fa-globe"></i></a>` : ''}
                        </div>
                    </div>`;
            });
        }

        // --- 5. 繪製圖表 ---
        function initChart() {
            const ctxCanvas = document.getElementById('scheduleChart');
            if (!ctxCanvas) return;
            
            // 篩選出考級類活動
            const examEvents = events.filter(e => e.type === 'exam');

            // 如果已有圖表，先銷毀以避免重複繪製
            if (scheduleChart) scheduleChart.destroy();

            scheduleChart = new Chart(ctxCanvas.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: examEvents.map(e => e.title.replace('國樂學會考級 - ', '').replace('全國音樂考級 (黃鐘獎) - 台北場', '黃鐘獎考級(台北)')),
                    datasets: [
                        { 
                            label: '報名期間', 
                            // 這裡 data 必須確保是數值 (timestamp)
                            data: examEvents.map(e => e.regStart ? [e.regStart.getTime(), e.regEnd.getTime()] : null), 
                            backgroundColor: 'rgba(217, 119, 6, 0.5)', 
                            borderColor: 'rgba(217, 119, 6, 1)', 
                            borderWidth: 1, 
                            barPercentage: 0.6 
                        },
                        { 
                            label: '考試日期', 
                            data: examEvents.map(e => {
                                // 處理多個考試日期的情況，這裡只取第一天做示意
                                if(e.examDates && e.examDates.length > 0) {
                                    const t = e.examDates[0].getTime();
                                    return [t, t + 86400000]; // 畫一天長度
                                }
                                return null;
                            }), 
                            backgroundColor: 'rgba(220, 38, 38, 0.8)', 
                            borderColor: 'rgba(220, 38, 38, 1)', 
                            borderWidth: 1, 
                            barPercentage: 0.3, 
                            borderRadius: 10 
                        }
                    ]
                },
                options: {
                    indexAxis: 'y', 
                    responsive: true, 
                    maintainAspectRatio: false,
                    scales: { 
                        x: { 
                            type: 'time', 
                            time: { unit: 'month', displayFormats: { month: 'M月' } }, 
                            min: new Date(YEAR, 0, 1).getTime(), 
                            max: new Date(YEAR, 6, 30).getTime() 
                        } 
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = context.raw;
                                    if (Array.isArray(value)) {
                                        const start = new Date(value[0]);
                                        const end = new Date(value[1]);
                                        // 考試日期如果是單日，顯示單日即可
                                        if (label === '考試日期') {
                                             return `${label}: ${start.getFullYear()}/${start.getMonth()+1}/${start.getDate()}`;
                                        }
                                        return `${label}: ${start.getFullYear()}/${start.getMonth()+1}/${start.getDate()} ~ ${end.getFullYear()}/${end.getMonth()+1}/${end.getDate()}`;
                                    } 
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        // --- 6. 頁面初始化 ---
        document.addEventListener('DOMContentLoaded', () => {
            // A. 載入資料
            loadData();

            // B. 手機版選單監聽
            const btn = document.getElementById('mobile-menu-btn');
            const menu = document.getElementById('mobile-menu');
            if(btn && menu) {
                const icon = btn.querySelector('i');
                btn.addEventListener('click', () => {
                    menu.classList.toggle('hidden');
                    if (menu.classList.contains('hidden')) {
                        icon.classList.remove('fa-times');
                        icon.classList.add('fa-bars');
                    } else {
                        icon.classList.remove('fa-bars');
                        icon.classList.add('fa-times');
                    }
                });
            }

            // C. 篩選按鈕監聽
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => {
                        b.classList.remove('bg-amber-600', 'text-white');
                        b.classList.add('text-stone-600', 'hover:bg-stone-100');
                        if(b.dataset.filter==='urgent') b.classList.add('text-red-600', 'hover:bg-red-50');
                    });
                    btn.classList.remove('text-stone-600', 'text-red-600', 'hover:bg-stone-100', 'hover:bg-red-50');
                    btn.classList.add('bg-amber-600', 'text-white');
                    renderCards(btn.dataset.filter);
                });
            });
        });
    </script>
</body>
</html>