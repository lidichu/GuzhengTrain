<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>箏心古箏-美食口袋名單-全台美食地圖</title>
    <!-- 在header div中添加以下内容，放在标题h1之前 -->
<div class="header">
    <a href="/" class="home-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
        <span>首頁</span>
    </a>
</div>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f5f5f5;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
            padding-top: 30px; /* 增加一点上方padding以容纳按钮 */
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .home-btn {
            position: absolute;
            left: 20px;
            top: 5px;
            display: flex;
            align-items: center;
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 12px;
            border-radius: 30px;
        }

        .home-btn svg {
            margin-right: 6px;
        }

        .home-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            gap: 20px;
            height: calc(100vh - 120px);
        }
        /* 导航按钮样式 */
.directions-btn {
    margin-top: 12px;
    text-align: center;
}

.directions-btn a {
    display: flex;
    align-items: center;
    justify-content: center;
    background: #4285F4;
    color: white;
    padding: 8px 12px;
    border-radius: 4px;
    text-decoration: none;
    font-size: 13px;
    font-weight: 500;
    transition: all 0.2s;
    width: 100%;
    box-shadow: 0 1px 2px rgba(0,0,0,0.2);
}

.directions-btn a svg {
    margin-right: 6px;
}

.directions-btn a:hover {
    background: #3367D6;
    transform: translateY(-1px);
    box-shadow: 0 3px 5px rgba(0,0,0,0.2);
}

.directions-btn a:active {
    transform: translateY(0);
}

/* 确保信息窗口样式适配按钮 */
.info-window {
    padding: 12px;
    max-width: 280px;
}
        .sidebar {
            width: 350px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow-y: auto;
        }
        
        .search-box {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
            transition: border-color 0.3s;
        }
        
        .search-box:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .filter-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .filter-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }
        
        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .restaurant-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .restaurant-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .restaurant-item:hover {
            background: #e9ecef;
            border-color: #667eea;
            transform: translateX(5px);
        }
        
        .restaurant-item.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .restaurant-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .restaurant-address {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .restaurant-award {
            display: inline-block;
            padding: 4px 8px;
            background: #ffd700;
            color: #333;
            border-radius: 4px;
            font-size: 12px;
            margin-top: 5px;
            font-weight: 600;
        }
        
        .restaurant-item.active .restaurant-award {
            background: white;
            color: #667eea;
        }
        
        #map {
            flex: 1;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .info-window {
            padding: 10px;
            max-width: 250px;
        }
        
        .info-window h3 {
            margin-bottom: 8px;
            color: #333;
        }
        
        .info-window p {
            margin-bottom: 5px;
            font-size: 14px;
            color: #666;
        }
        
        .info-window .award {
            display: inline-block;
            padding: 4px 8px;
            background: #ffd700;
            color: #333;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
        }
        
        @media (max-width: 768px) {
   /* 基本布局调整 */
   .container {
        flex-direction: column;
        height: auto;
        padding: 12px;
        gap: 12px;
    }
    .home-btn {
        left: 10px;
        top: 10px;
        padding: 6px 10px;
        font-size: 14px;
    }
    
    .home-btn svg {
        width: 20px;
        height: 20px;
    }
    
    .header {
        padding-top: 25px;
    }
    .sidebar {
        width: 100%;
        max-height: none; /* 移除最大高度限制 */
        height: auto;
        padding: 15px;
    }
    
    #map {
        height: 350px; /* 减小地图高度以便更好地浏览餐厅列表 */
        margin-bottom: 20px;
    }
    
    /* 页眉调整 */
    .header {
        padding: 15px 10px;
    }
    
    .header h1 {
        font-size: 22px;
        margin-bottom: 6px;
    }
    
    .header p {
        font-size: 14px;
    }
    
    /* 筛选区域优化 */
    .filter-buttons {
        gap: 6px;
    }
    
    .filter-btn {
        padding: 6px 12px;
        font-size: 13px;
    }
    
    .award-filter-btn {
        padding: 5px 10px;
        font-size: 12px;
    }
    
    /* 统计区域优化 */
    .stats {
        padding: 12px;
        margin-bottom: 15px;
    }
    
    .stat-number {
        font-size: 18px;
    }
    
    .stat-label {
        font-size: 11px;
    }
    
    /* 搜索框优化 */
    .search-box {
        padding: 10px;
        margin-bottom: 15px;
    }
    
    /* 餐厅列表项目优化 */
    .restaurant-item {
        padding: 12px;
    }
    
    .restaurant-name {
        font-size: 15px;
    }
    
    .restaurant-address {
        font-size: 13px;
    }
        }

        /* 添加极小屏幕设备的特殊处理 */
@media (max-width: 375px) {
    .header h1 {
        font-size: 20px;
    }
    
    .filter-btn {
        padding: 5px 10px;
        font-size: 12px;
    }
    
    .award-filter-btn {
        padding: 4px 8px;
        font-size: 11px;
    }
    
    .stats-numbers {
        flex-wrap: wrap;
    }
    
    .stat-item {
        flex-basis: 50%;
        margin-bottom: 8px;
    }
    
    /* 纵向排列统计项目 */
    .stats-numbers {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
    }
    
    /* 调整地图高度 */
    #map {
        height: 280px;
    }
    .home-btn span {
        display: none; /* 在超小屏幕上只显示图标 */
    }
    
    .home-btn {
        padding: 8px;
    }
    
    .home-btn svg {
        margin-right: 0;
    }
}

/* 添加横屏模式优化 */
@media (max-width: 896px) and (orientation: landscape) {
    .container {
        flex-direction: row; /* 横屏时恢复为行布局 */
        height: calc(100vh - 100px);
    }
    
    .sidebar {
        width: 40%;
        height: 100%;
        overflow-y: auto;
    }
    
    #map {
        height: auto;
        flex: 1;
    }
    
    .header {
        padding: 10px;
    }
    
    .header h1 {
        font-size: 20px;
        margin-bottom: 4px;
    }
    
    .header p {
        font-size: 12px;
    }
}

/* 优化触摸交互 */
@media (pointer: coarse) {
    .filter-btn, .award-filter-btn, .restaurant-item {
        min-height: 44px; /* 确保可点击区域足够大 */
    }
    
    .search-box {
        height: 44px;
    }
}
    </style>
</head>
<body>
    <div class="header">
        <h1>箏心古箏-全台美食地圖</h1>
        <p>隱藏美食口袋名單好料跟你分享別讓太多人知道</p>
    </div>
    
    <div class="container">
        <div class="sidebar">
            <input type="text" class="search-box" placeholder="搜尋餐廳名稱或地址..." id="searchInput">
            
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">全部</button>
                <button class="filter-btn" data-filter="基隆">基隆</button>
                <button class="filter-btn" data-filter="台北">台北</button>
                <button class="filter-btn" data-filter="新北">新北</button>
                <button class="filter-btn" data-filter="桃園">桃園</button>
                <button class="filter-btn" data-filter="新竹">新竹</button>
                <button class="filter-btn" data-filter="苗栗">苗栗</button>
                <button class="filter-btn" data-filter="台中">台中</button>
                <button class="filter-btn" data-filter="南投">南投</button>
                <button class="filter-btn" data-filter="彰化">彰化</button>
                <button class="filter-btn" data-filter="嘉義">嘉義</button>
                <button class="filter-btn" data-filter="台南">台南</button>
                <button class="filter-btn" data-filter="高雄">高雄</button>
                <button class="filter-btn" data-filter="屏東">高雄</button>
                <button class="filter-btn" data-filter="宜蘭">宜蘭</button>
                <button class="filter-btn" data-filter="花蓮">花蓮</button>
                <button class="filter-btn" data-filter="台東">台東</button>
            </div>
            
            <div class="restaurant-list" id="restaurantList"></div>
        </div>
        
        <div id="map"></div>
    </div>

    <script>
        // 餐廳資料（包含推測的地址）
        const restaurants = [];
        let map;
        let markers = [];
        let activeMarker = null;
        let infoWindow;
// 當頁面載入完成後，從JSON檔案加載餐廳資料
    document.addEventListener('DOMContentLoaded', function() {
        // 從 restaurants.json 檔案加載資料
        fetch('restaurants.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('無法載入餐廳資料');
                }
                return response.json();
            })
            .then(data => {
                restaurants = data; // 將載入的資料指派給 restaurants 變數
                // 初始化地圖
                initMap();
            })
            .catch(error => {
                console.error('加載餐廳資料時發生錯誤:', error);
                alert('無法載入餐廳資料，請重新整理頁面或稍後再試。');
            });
    });
// 修改initMap函数，使用地址而非经纬度定位
function initMap() {
    // 设定地图中心点（台湾中部）
    const taiwan = { lat: 23.9037, lng: 121.0794 };
    
    map = new google.maps.Map(document.getElementById('map'), {
        zoom: 7,
        center: taiwan,
        styles: [
            {
                featureType: "poi",
                elementType: "labels",
                stylers: [{ visibility: "off" }]
            }
        ]
    });

    infoWindow = new google.maps.InfoWindow();
    
    // 创建地理编码服务
    const geocoder = new google.maps.Geocoder();
    
    // 计数器追踪已处理的餐厅数量
    let processedCount = 0;
    
    // 为每个餐厅创建标记
    restaurants.forEach((restaurant, index) => {
        // 根据奖项决定图标颜色
        let awardLevel = 1;
        if (restaurant.award === "2碗") awardLevel = 2;
        if (restaurant.award === "3碗") awardLevel = 3;
        
        const markerIcon = {
            url: awardLevel === 3 
                ? 'http://maps.google.com/mapfiles/ms/icons/yellow-dot.png'
                : awardLevel === 2
                ? 'http://maps.google.com/mapfiles/ms/icons/red-dot.png'
                : 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png',
            scaledSize: new google.maps.Size(40, 40)
        };

        // 优先使用经纬度，如果不准确则使用地址
        if (isValidLatLng(restaurant.lat, restaurant.lng)) {
            createMarker(restaurant, index, { lat: restaurant.lat, lng: restaurant.lng }, markerIcon);
            processedCount++;
            
            // 所有餐厅处理完毕后更新统计和列表
            if (processedCount === restaurants.length) {
                updateStats();
                renderRestaurantList();
            }
        } else {
            // 使用地址进行地理编码
            geocoder.geocode({ 'address': restaurant.address }, function(results, status) {
                if (status === 'OK' && results[0]) {
                    const position = results[0].geometry.location;
                    
                    // 更新餐厅的经纬度（可选）
                    restaurant.lat = position.lat();
                    restaurant.lng = position.lng();
                    
                    createMarker(restaurant, index, position, markerIcon);
                } else {
                    console.warn(`地理编码失败: ${restaurant.name}, ${restaurant.address}, 状态: ${status}`);
                    // 创建默认位置的标记（台湾中心点附近的随机位置）
                    const randomOffset = () => (Math.random() - 0.5) * 2;
                    const fallbackPosition = {
                        lat: taiwan.lat + randomOffset(),
                        lng: taiwan.lng + randomOffset()
                    };
                    createMarker(restaurant, index, fallbackPosition, markerIcon);
                }
                
                processedCount++;
                // 所有餐厅处理完毕后更新统计和列表
                if (processedCount === restaurants.length) {
                    updateStats();
                    renderRestaurantList();
                }
            });
        }
    });
}

// 辅助函数：检查经纬度是否有效
function isValidLatLng(lat, lng) {
    return lat && lng && 
           !isNaN(lat) && !isNaN(lng) && 
           lat >= 21.5 && lat <= 25.5 && // 台湾纬度范围
           lng >= 119.5 && lng <= 122.5; // 台湾经度范围
}

// 辅助函数：创建标记
function createMarker(restaurant, index, position, markerIcon) {
    const marker = new google.maps.Marker({
        position: position,
        map: map,
        title: restaurant.name,
        icon: markerIcon
    });

    marker.addListener('click', () => {
        showRestaurantInfo(restaurant, marker);
        highlightRestaurant(index);
    });

    markers.push(marker);
}

// 修改showRestaurantInfo函数，使用地址导航到Google地图
function showRestaurantInfo(restaurant, marker) {
    // 获取奖项级别用于CSS类名
    let awardClass = "award-1";
    if (restaurant.award === "2碗") awardClass = "award-2";
    if (restaurant.award === "3碗") awardClass = "award-3";
    
    // 编码地址用于Google Maps URL
    const encodedAddress = encodeURIComponent(restaurant.address);
    
    const content = `
        <div class="info-window">
            <h3>${restaurant.name}</h3>
            <p><strong>類別：</strong>${restaurant.category || '其他'}</p>
            <p><strong>地址：</strong>${restaurant.address}</p>
            <div class="award ${awardClass}">${restaurant.award}</div>
            <div class="directions-btn">
                <a href="https://www.google.com/maps/search/?api=1&query=${restaurant.city}${restaurant.name}" target="_blank">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                    在Google地圖中導航
                </a>
            </div>
        </div>
    `;
    
    infoWindow.setContent(content);
    infoWindow.open(map, marker);
    
    // 将地图中心移到该标记
    map.panTo(marker.getPosition());
    map.setZoom(16);
    
    // 高亮显示侧边栏中的餐厅
    highlightRestaurant(restaurants.indexOf(restaurant));
}

        // 顯示餐廳資訊視窗
        function showRestaurantInfo(restaurant, marker) {
                // 获取奖项级别用于CSS类名
    let awardClass = "award-1";
    if (restaurant.award === "2碗") awardClass = "award-2";
    if (restaurant.award === "3碗") awardClass = "award-3";
        // 编码地址用于Google Maps URL
        const encodedAddress = encodeURIComponent(restaurant.address);
            const content = `
        <div class="info-window">
            <h3>${restaurant.name}</h3>
            <p><strong>類別：</strong>${restaurant.category}</p>
            <p><strong>地址：</strong>${restaurant.address}</p>
            <div class="award ${awardClass}">${restaurant.award}</div>
            <div class="directions-btn">
                <a href="https://www.google.com/maps/search/?api=1&query=${restaurant.city}${restaurant.name}" target="_blank">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                    在Google地圖中導航
                </a>
            </div>
        </div>
    `;
            
            infoWindow.setContent(content);
            infoWindow.open(map, marker);
            
            // 將地圖中心移到該標記
            map.panTo(marker.getPosition());
            map.setZoom(16);
        }

        // 渲染餐廳列表
        function renderRestaurantList(filteredRestaurants = restaurants) {
            const listContainer = document.getElementById('restaurantList');
            listContainer.innerHTML = '';

            filteredRestaurants.forEach((restaurant, index) => {
                const item = document.createElement('div');
                item.className = 'restaurant-item';
                item.innerHTML = `
                    <div class="restaurant-name">${restaurant.name}<span class="restaurant-award">${restaurant.award}獎</span></div>
                    <div class="restaurant-address">${restaurant.address}</div>                    
                               <div class="directions-btn">
                <a href="https://www.google.com/maps/search/?api=1&query=${restaurant.city}${restaurant.name}" target="_blank">
                    <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                    在Google地圖中導航
                </a>
            </div>
                `;
                
                item.addEventListener('click', () => {
                    const markerIndex = restaurants.indexOf(restaurant);
                    google.maps.event.trigger(markers[markerIndex], 'click');
                });

                listContainer.appendChild(item);
            });
        }

        // 高亮顯示選中的餐廳
        function highlightRestaurant(index) {
            document.querySelectorAll('.restaurant-item').forEach((item, i) => {
                if (i === index) {
                    item.classList.add('active');
                    item.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                } else {
                    item.classList.remove('active');
                }
            });
        }

        // 搜尋功能
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filtered = restaurants.filter(restaurant => 
                restaurant.name.toLowerCase().includes(searchTerm) ||
                restaurant.address.toLowerCase().includes(searchTerm) ||
                restaurant.category.toLowerCase().includes(searchTerm)
            );
            
            renderRestaurantList(filtered);
            
            // 更新地圖標記可見性
            markers.forEach((marker, index) => {
                marker.setVisible(filtered.includes(restaurants[index]));
            });
        });

        // 篩選功能
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // 更新按鈕狀態
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                const filter = btn.getAttribute('data-filter');
                let filtered = restaurants;
                
                if (filter !== 'all') {
                    filtered = restaurants.filter(r => r.city === filter);
                }
                
                renderRestaurantList(filtered);
                
                // 更新地圖標記可見性
                markers.forEach((marker, index) => {
                    marker.setVisible(filter === 'all' || restaurants[index].city === filter);
                });
                
                // 調整地圖視野
                if (filtered.length > 0) {
                    const bounds = new google.maps.LatLngBounds();
                    filtered.forEach(restaurant => {
                        bounds.extend(new google.maps.LatLng(restaurant.lat, restaurant.lng));
                    });
                    map.fitBounds(bounds);
                }
            });
        });
    </script>
    
    <!-- 請替換 YOUR_API_KEY 為您的 Google Maps API 金鑰 -->
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBBEZEqrNZA2irkersNDGRZpSvjYQDc7m4&callback=initMap&language=zh-TW">
    </script>
</body>
</html>
